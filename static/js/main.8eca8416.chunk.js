(this["webpackJsonploop-hero-tiler"]=this["webpackJsonploop-hero-tiler"]||[]).push([[0],[,,,,,,,,function(e,t,a){e.exports={root:"TilerOptions_root__3NoQD",line:"TilerOptions_line__CqBtH",form:"TilerOptions_form__1X5oS"}},function(e,t,a){e.exports={grid:"TilerMapGrid_grid__1qMcD",tile:"TilerMapGrid_tile__1cPqI",overlay:"TilerMapGrid_overlay__34avY",weak:"TilerMapGrid_weak__QSb5X",strong:"TilerMapGrid_strong__2ENK2",metaValue:"TilerMapGrid_metaValue__2MQkx",spriteWrapper:"TilerMapGrid_spriteWrapper__7nIWn"}},function(e,t,a){e.exports={root:"TilerPanels_root__JMW_0",tabs:"TilerPanels_tabs__ANLdR",body:"TilerPanels_body__2SRcy",tab:"TilerPanels_tab__1G8dR",active:"TilerPanels_active__xexhi",element:"TilerPanels_element__heazb"}},,function(e,t,a){e.exports={root:"TilerMapPanel_root__dUuXD",gridWrapper:"TilerMapPanel_gridWrapper__s_FfO",innerGridWrapper:"TilerMapPanel_innerGridWrapper__3r49Z",paletteWrapper:"TilerMapPanel_paletteWrapper__2SLyo"}},,,function(e,t,a){e.exports={rootWrapper:"TileManager_rootWrapper__3N7RU",tabviewWrapper:"TileManager_tabviewWrapper__NQP4B"}},function(e,t,a){e.exports={root:"TilerPalette_root__34cPI",tileWrapper:"TilerPalette_tileWrapper__1fiUo"}},function(e,t,a){e.exports={root:"TilerPaletteOption_root__FOhSs",active:"TilerPaletteOption_active__18CBp"}},,,function(e,t,a){e.exports={root:"TilerStringPanel_root__1sspR"}},,,,,,function(e,t,a){},function(e,t,a){},,,,function(e,t,a){"use strict";a.r(t);var i,n=a(1),r=a.n(n),l=a(18),o=a.n(l),c=(a(26),a(27),a(2)),s=a(15),u=a.n(s),d={handleError:function(e){console.error(e),alert("Application error! Check dev console (F12).")}},p=a(10),h=a.n(p),f=a(0),m=function(e){var t=e.elements,a=r.a.useState(0),i=Object(c.a)(a,2),n=i[0],l=i[1],o=t[n].element;return Object(f.jsxs)("div",{className:h.a.root,children:[Object(f.jsx)("div",{className:h.a.tabs+" noselect",children:t.map((function(e,t){return Object(f.jsx)("div",{className:h.a.tab+(n===t?" "+h.a.active:""),onClick:function(e){return l(t)},children:e.label},t)}))}),Object(f.jsx)("div",{className:h.a.body,children:o})]})},j=a(5),v=a(8),O=a.n(v),b=a(19),x=a.n(b),g={normal:"Normal",value:"Show values"},y=function(e){var t,a=function(t,a){t.preventDefault();var i=t.currentTarget.value.trim(),n=parseInt(i);isNaN(n)&&(n=null),n!==e.value&&e.setValue(i?n:null),a&&n&&!isNaN(Math.min(n))&&e.doUpdateValue(n)};return Object(f.jsx)("input",{type:"text",id:"mapGridHeightPx",value:null!==(t=e.value)&&void 0!==t?t:"",style:{width:100},onChange:function(e){return a(e,!1)},onBlur:function(e){return a(e,!0)},onKeyDown:function(e){"Enter"===e.key&&a(e,!0)}})},T=function(e){var t=r.a.useState(e.mapRendererOptions.mapGridWidthPx),a=Object(c.a)(t,2),i=a[0],n=a[1],l=r.a.useState(e.mapRendererOptions.mapGridHeightPx),o=Object(c.a)(l,2),s=o[0],u=o[1],d=r.a.useState(e.mapRendererOptions.cellWidthPx),p=Object(c.a)(d,2),h=p[0],m=p[1],v=r.a.useState(e.mapRendererOptions.cellHeightPx),b=Object(c.a)(v,2),T=b[0],_=b[1],P=r.a.useState(e.mapRendererOptions.cellFontSizePx),k=Object(c.a)(P,2),w=k[0],N=k[1];return Object(f.jsxs)("div",{className:O.a.root,children:[Object(f.jsxs)("div",{className:O.a.line,children:[Object(f.jsxs)("div",{className:O.a.form,children:[Object(f.jsx)("label",{htmlFor:"renderMode",children:"Render Mode"}),Object(f.jsx)("select",{id:"renderMode",onChange:function(t){return function(t){var a=t.currentTarget.value;e.setMapRendererOptions(Object(j.a)(Object(j.a)({},e.mapRendererOptions),{},{renderMode:a}))}(t)},children:Object.keys(g).map((function(e){return Object(f.jsx)("option",{value:e,children:g[e]},e)}))})]}),Object(f.jsxs)("div",{className:O.a.form,children:[Object(f.jsx)("label",{htmlFor:"mapGridWidthPx",children:"Canvas Width"}),Object(f.jsx)(y,{value:i,setValue:n,doUpdateValue:function(t){t=Math.min(t,4e3),t=Math.max(t,300),e.setMapRendererOptions(Object(j.a)(Object(j.a)({},e.mapRendererOptions),{},{mapGridWidthPx:t}))}})]}),Object(f.jsxs)("div",{className:O.a.form,children:[Object(f.jsx)("label",{htmlFor:"mapGridHeightPx",children:"Canvas Height"}),Object(f.jsx)(y,{value:s,setValue:u,doUpdateValue:function(t){t=Math.max(t,200),e.setMapRendererOptions(Object(j.a)(Object(j.a)({},e.mapRendererOptions),{},{mapGridHeightPx:t}))}})]}),Object(f.jsxs)("div",{className:O.a.form,children:[Object(f.jsx)("label",{htmlFor:"cellWidthPx",children:"Cell Width"}),Object(f.jsx)(y,{value:h,setValue:m,doUpdateValue:function(t){e.setMapRendererOptions(Object(j.a)(Object(j.a)({},e.mapRendererOptions),{},{cellWidthPx:t}))}})]}),Object(f.jsxs)("div",{className:O.a.form,children:[Object(f.jsx)("label",{htmlFor:"cellHeightPx",children:"Cell Height"}),Object(f.jsx)(y,{value:T,setValue:_,doUpdateValue:function(t){e.setMapRendererOptions(Object(j.a)(Object(j.a)({},e.mapRendererOptions),{},{cellHeightPx:t}))}})]}),Object(f.jsxs)("div",{className:O.a.form,children:[Object(f.jsx)("label",{htmlFor:"cellFontSizePx",children:"Cell Font Size"}),Object(f.jsx)(y,{value:w,setValue:N,doUpdateValue:function(t){e.setMapRendererOptions(Object(j.a)(Object(j.a)({},e.mapRendererOptions),{},{cellFontSizePx:t}))}})]})]}),Object(f.jsxs)("div",{className:O.a.line,children:[Object(f.jsx)("button",{onClick:function(){return function(){var t=e.mapRendererOptions,a=fe;x.a.isEqual(t,a)||(e.setMapRendererOptions(a),n(a.mapGridWidthPx),u(a.mapGridHeightPx),m(a.cellWidthPx),_(a.cellHeightPx),N(a.cellFontSizePx))}()},children:"Reset options"}),Object(f.jsx)("div",{style:{width:8}}),Object(f.jsx)("button",{onClick:function(){e.resetMap()},children:"Clear all tiles"})]})]})},_=a(9),P=a.n(_),k=function(e){var t=Math.min(e.parentProps.mapRendererOptions.cellWidthPx,e.parentProps.mapRendererOptions.cellHeightPx),a=r.a.useMemo((function(){return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("div",{style:{width:t,height:t},children:e.useSprite}),null!==e.metaValue&&Object(f.jsx)("div",{className:P.a.metaValue,children:Object(f.jsx)("span",{children:e.metaValue})}),null!==e.useSprite?Object(f.jsx)("div",{className:P.a.overlay+" "+P.a.strong}):Object(f.jsx)("div",{className:P.a.overlay+" "+P.a.weak})]})}),[e.metaValue,t,e.useSprite]);return Object(f.jsx)("div",{className:P.a.tile,style:e.cellStyle,onMouseUp:function(t){var a=t.button;e.parentProps.onClick(e.posX,e.posY,a)},onContextMenu:function(e){return e.preventDefault(),!1},children:a})},w=function(e){var t={width:e.mapRendererOptions.cellWidthPx+2,height:e.mapRendererOptions.cellHeightPx+2},a=Array.from(new Array(e.mapDefinitions.mapWidth*e.mapDefinitions.mapHeight)).map((function(a,i){var n=e.tileData[i],r=e.tileResolver.getTileFromId(n),l=i%e.mapDefinitions.mapWidth,o=Math.floor(i/e.mapDefinitions.mapWidth),c=r.renderImage(e.world,l,o),s="value"===e.mapRendererOptions.renderMode?r.calculateValueAsString(e.world,l,o):null,u=null!==c?e.spritePool[c.spriteName]:null;return Object(f.jsx)(k,{cellStyle:t,parentProps:e,posX:l,posY:o,tile:r,world:e.world,metaValue:s,useSprite:u},i)}));return Object(f.jsx)("div",{className:P.a.grid+" noselect",style:{width:e.mapDefinitions.mapWidth*(e.mapRendererOptions.cellWidthPx+2),fontSize:e.mapRendererOptions.cellFontSizePx},children:a})},N=a(12),R=a.n(N),W=a(16),S=a.n(W),M=a(17),A=a.n(M),D=function(e){var t="res/palette/"+e.tile.paletteImage()+".png";return Object(f.jsx)("div",{className:A.a.root+" "+(e.isActive?A.a.active:""),onClick:function(t){return e.toggle()},children:Object(f.jsx)("img",{src:t,alt:e.tile.idName,title:e.tile.idName})})},V=function(e){var t=r.a.useState(e.paletteController.currentTile),a=Object(c.a)(t,2),i=a[0],n=a[1];r.a.useEffect((function(){e.paletteController.currentTile=i}),[i,e.paletteController]);return Object(f.jsx)("div",{className:S.a.root+" noselect",children:e.allTiles.filter((function(e){return e.showsOnPalette()})).map((function(e,t){return Object(f.jsx)("div",{className:S.a.tileWrapper,children:Object(f.jsx)(D,{tile:e,isActive:e===i,toggle:function(){return function(e){n(i===e?null:e)}(e)}})},t)}))})},C=function(e){return Object(f.jsxs)("div",{className:R.a.root,children:[Object(f.jsx)("div",{className:R.a.gridWrapper,children:Object(f.jsx)("div",{className:R.a.innerGridWrapper,children:Object(f.jsx)(w,{tileData:e.tileData,mapRendererOptions:e.mapRendererOptions,mapDefinitions:e.mapDefinitions,tileResolver:e.tileResolver,spritePool:e.spritePool,onClick:e.onClick,world:e.world})})}),Object(f.jsx)("div",{className:R.a.paletteWrapper,children:Object(f.jsx)(V,{allTiles:e.tileResolver.allTiles,paletteController:e.paletteController})})]})},I=a(20),F=a.n(I),H=function(e){return Object(f.jsx)("div",{className:F.a.root,children:"TODO import/export..."})},G=a(3),U=a(4),E=a(7),z=a(6),L=function(){function e(t){Object(G.a)(this,e),this.idName=void 0,this.idName=t}return Object(U.a)(e,[{key:"calculateValue",value:function(e,t,a){return null}},{key:"calculateValueAsString",value:function(e,t,a){return null}},{key:"renderImage",value:function(e,t,a){return{spriteName:this.idName}}},{key:"showsOnPalette",value:function(){return!0}},{key:"paletteImage",value:function(){return this.idName}},{key:"onTilePlaced",value:function(e,t,a){return!1}},{key:"onTileReplaced",value:function(e,t,a,i){return!1}},{key:"iterateAdjacentTiles",value:function(e,t,a,i,n){n(e.getTileAt(t-1,a)),n(e.getTileAt(t+1,a)),n(e.getTileAt(t,a-1)),n(e.getTileAt(t,a+1)),i&&(n(e.getTileAt(t-1,a-1)),n(e.getTileAt(t+1,a-1)),n(e.getTileAt(t-1,a+1)),n(e.getTileAt(t+1,a+1)))}}]),e}(),B=function(e){Object(E.a)(a,e);var t=Object(z.a)(a);function a(){return Object(G.a)(this,a),t.apply(this,arguments)}return Object(U.a)(a,[{key:"renderImage",value:function(e,t,a){return null}}]),a}(L),J=function(e){Object(E.a)(a,e);var t=Object(z.a)(a);function a(){return Object(G.a)(this,a),t.apply(this,arguments)}return Object(U.a)(a,[{key:"calculateValue",value:function(e,t,i){var n=1;return this.iterateAdjacentTiles(e,t,i,!1,(function(e){(e instanceof a||e instanceof X)&&(n+=1)})),n}},{key:"calculateValueAsString",value:function(e,t,a){var i=this.calculateValue(e,t,a);return i>0?"+"+i:""+i}}]),a}(L),X=function(e){Object(E.a)(a,e);var t=Object(z.a)(a);function a(){return Object(G.a)(this,a),t.apply(this,arguments)}return Object(U.a)(a,[{key:"calculateValue",value:function(e,t,i){var n=0;return this.iterateAdjacentTiles(e,t,i,!1,(function(e){(e instanceof J||e instanceof a)&&(n+=2)})),n}},{key:"calculateValueAsString",value:function(e,t,a){var i=this.calculateValue(e,t,a);return i>0?"+"+i:""+i}}]),a}(L),q=["topleft","topcenter","topright","midleft","midcenter","midright","botleft","botcenter","botright"],Q=function(e){Object(E.a)(a,e);var t=Object(z.a)(a);function a(){return Object(G.a)(this,a),t.apply(this,arguments)}return Object(U.a)(a,[{key:"showsOnPalette",value:function(){return!1}},{key:"calculateValue",value:function(e,t,a){var i=this.calculatePosition(e,t,a);if(null===i)return 0;if("midcenter"===i)return 48;var n=0;return this.iterateAdjacentTiles(e,t,a,!1,(function(e){(e instanceof J||e instanceof X)&&(n+=2)})),n}},{key:"calculateValueAsString",value:function(e,t,a){var i=this.calculateValue(e,t,a);return i>0?"+"+i:""+i}},{key:"renderImage",value:function(e,t,a){var i=this.calculatePosition(e,t,a);return{spriteName:null===i?"error":"peak-".concat(i)}}},{key:"onTilePlaced",value:function(e,t,a){return t%2===0&&e.tryToSetTileAt(t+1,a,this)}},{key:"onTileReplaced",value:function(e,t,a,i){if(i===ie)return!1;for(var n={x:t,y:a},r=1;r<3;r++){if(e.getTileAt(n.x-1,n.y)!==this)break;n={x:n.x-1,y:n.y}}for(var l=1;l<3;l++){if(e.getTileAt(n.x,n.y-1)!==this)break;n={x:n.x,y:n.y-1}}for(var o=0;o<3;o++)for(var c=0;c<3;c++)e.getTileAt(n.x+o,n.y+c)===this&&e.setTileAt(n.x+o,n.y+c,Z,!0);return!0}},{key:"calculatePosition",value:function(e,t,a){for(var i,n=[t,a],r=1;r<3;r++){if(e.getTileAt(n[0]-1,n[1])!==this)break;n=[n[0]-1,n[1]]}for(var l=1;l<3;l++){if(e.getTileAt(n[0],n[1]-1)!==this)break;n=[n[0],n[1]-1]}var o=t-n[0],c=a-n[1];return null!==(i=q[3*c+o])&&void 0!==i?i:null}}]),a}(L),Y=function(e){Object(E.a)(a,e);var t=Object(z.a)(a);function a(){return Object(G.a)(this,a),t.apply(this,arguments)}return Object(U.a)(a,[{key:"paletteImage",value:function(){return"peak"}},{key:"renderImage",value:function(e,t,a){return{spriteName:"peak"}}},{key:"onTilePlaced",value:function(e,t,a){for(var i={x:t,y:a},n=1;n<3;n++){if(e.getTileAt(i.x-1,i.y)!==this)break;i={x:i.x-1,y:i.y}}for(var r=1;r<3;r++){if(e.getTileAt(i.x,i.y-1)!==this)break;i={x:i.x,y:i.y-1}}for(var l=!0,o=0;o<3;o++)for(var c=0;c<3;c++){if(e.getTileAt(i.x+o,i.y+c)!==this){l=!1;break}}if(l)for(var s=0;s<3;s++)for(var u=0;u<3;u++)e.setTileAt(i.x+s,i.y+u,ae,!0);return l}}]),a}(L),K=function(e){Object(E.a)(a,e);var t=Object(z.a)(a);function a(){return Object(G.a)(this,a),t.apply(this,arguments)}return Object(U.a)(a,[{key:"renderImage",value:function(e,t,a){return null}},{key:"showsOnPalette",value:function(){return!1}}]),a}(L),Z=new B("empty"),$=new K("road"),ee=new J("rock"),te=new X("mountain"),ae=new Q("peak"),ie=new Y("proto-peak"),ne=[Z,$,ee,te,ae,ie],re=Z,le=(new Date).getTime(),oe={jsonUrl:"dist/spritesheet.json?ts="+le,imageUrl:"dist/spritesheet.png?ts="+le},ce=[oe.imageUrl],se=function(){function e(){Object(G.a)(this,e)}return Object(U.a)(e,[{key:"loadJson",value:function(){return fetch("tiles.json?ts="+le).then((function(e){return e.json()}))}},{key:"loadSpritesheetInfo",value:function(){return fetch(oe.jsonUrl).then((function(e){return e.json()})).then((function(e){var t={},a=e.spritesheet.width,i=e.spritesheet.height;for(var n in e.sprites){var r=e.sprites[n];t[n]={x:r.x,y:r.y,w:r.width,h:r.height}}return{id:e.spritesheet.name,url:oe.imageUrl,meta:{image:e.spritesheet.image,wid:a,hei:i},coordinateMap:t}}))}},{key:"loadSpritesheetImage",value:function(){return Promise.all(ce.map((function(e){return new Promise((function(t,a){var i=new Image;i.onload=t,i.onerror=a,i.src=e}))}))).then()}}]),e}();!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(i||(i={}));var ue=a(21),de=function(){function e(t,a,i,n){Object(G.a)(this,e),this.mapDefs=void 0,this.tileResolver=void 0,this._data=void 0,this.updateData=void 0,this.mapDefs=t,this.tileResolver=a,this._data=i,this.updateData=n}return Object(U.a)(e,[{key:"mapWidth",get:function(){return this.mapDefs.mapWidth}},{key:"mapHeight",get:function(){return this.mapDefs.mapHeight}},{key:"data",get:function(){return this._data}},{key:"overwriteData",value:function(e){this._data=e}},{key:"getTileAt",value:function(e,t){if(!(e<0||e>=this.mapWidth||t<0||t>=this.mapHeight)){var a=this._data[t*this.mapWidth+e];return this.tileResolver.getTileFromId(a)}}},{key:"setTileAt",value:function(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=this.getTileAt(e,t);if(a!==n&&void 0!==n){var r=this.tileResolver.getIdFromTile(a);this._data[t*this.mapWidth+e]=r,i||(n.onTileReplaced(this,e,t,a),a.onTilePlaced(this,e,t)),this.updateData(Object(ue.a)(this._data))}}},{key:"tryToSetTileAt",value:function(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.setTileAt(e,t,a,i),!0}}]),e}(),pe=new se,he=function(e){var t=r.a.useState("Loading..."),a=Object(c.a)(t,2),n=a[0],l=a[1],o=r.a.useState(),s=Object(c.a)(o,2),p=s[0],h=s[1],j=r.a.useState({mapWidth:e.mapWidth,mapHeight:e.mapHeight}),v=Object(c.a)(j,2),O=v[0],b=v[1],x=r.a.useState(),g=Object(c.a)(x,2),y=g[0],_=g[1],P=r.a.useState(),k=Object(c.a)(P,2),w=k[0],N=k[1],R=r.a.useState(fe),W=Object(c.a)(R,2),S=W[0],M=W[1],A=r.a.useState(),D=Object(c.a)(A,2),V=D[0],I=D[1],F=r.a.useState(),G=Object(c.a)(F,2),U=G[0],E=G[1],z=r.a.useRef({currentTile:null});if(r.a.useEffect((function(){l("Loading tiles..."),pe.loadJson().then((function(e){l("Loading spritesheet information..."),pe.loadSpritesheetInfo().then((function(t){l("Loading spritesheet image..."),pe.loadSpritesheetImage().then((function(){l("Generating sprite elements..."),h(e),I(function(e){var t={};for(var a in e.coordinateMap){var i=e.coordinateMap[a],n=e.meta.wid/i.w*100+"%",r=e.meta.hei/i.h*100+"%",l=i.x/(e.meta.wid-i.w)*100+"%",o=i.y/(e.meta.hei-i.h)*100+"%",c=Object(f.jsx)("div",{className:"sprite",style:{backgroundImage:"url('".concat(e.url,"')"),backgroundPosition:"".concat(l," ").concat(o),backgroundSize:"".concat(n," ").concat(r),width:"100%",height:"100%"}});t[a]=c}return t}(t))}))}))})).catch(d.handleError)}),[]),r.a.useEffect((function(){if(p){var e=p,t={},a={},i=function(i){var n=parseInt(i),r=e[i],l=ne.find((function(e){return e.idName===r}));if(!l)throw new Error("No tile registered with name: '".concat(r,"'"));for(var o in t){if(t[o].idName===r)throw new Error("Two tiles have duplicated id names: ".concat(r))}t[n]=l,a[l.idName]=n};for(var n in e)i(n);_({allTiles:ne,getTileFromId:function(e){return t[e]},getIdFromTile:function(e){return a[e.idName]}})}}),[p]),r.a.useEffect((function(){if(y){var e=y.getIdFromTile(re),t=me(O.mapWidth,O.mapHeight,e);N(t),E(new de(O,y,t,N))}}),[y,O]),!p||!w||!y||!V||!U)return Object(f.jsx)("div",{children:n});var L=Object(f.jsx)(C,{tileData:w,setTileData:N,mapDefinitions:O,mapRendererOptions:S,tileResolver:y,paletteController:z.current,spritePool:V,onClick:function(e,t,a){if(e<0||e>=O.mapWidth||t<0||t>=O.mapHeight)console.error("onTileClick out of bounds: [".concat(e,", ").concat(t,"]"));else{var n=a===i.Right?re:z.current.currentTile;null!==n&&U.tryToSetTileAt(e,t,n)}},world:U}),B=Object(f.jsx)(H,{});return Object(f.jsxs)("div",{className:u.a.rootWrapper,children:[Object(f.jsx)("div",{className:u.a.tabviewWrapper,style:{width:S.mapGridWidthPx,height:S.mapGridHeightPx},children:Object(f.jsx)(m,{elements:[{element:L,label:"Tile Map"},{element:B,label:"Import/Export"}]})}),Object(f.jsx)(T,{mapDefinitions:O,setMapDefinitions:b,mapRendererOptions:S,setMapRendererOptions:M,resetMap:function(){var e=y.getIdFromTile(re),t=me(O.mapWidth,O.mapHeight,e);U.overwriteData(t),N(t)}})]})},fe={mapGridWidthPx:800,mapGridHeightPx:650,cellWidthPx:44,cellHeightPx:44,cellFontSizePx:16,renderMode:"normal"};function me(e,t,a){return new Array(e*t).fill(a)}var je=function(){return Object(f.jsx)("div",{className:"App",children:Object(f.jsx)(he,{mapWidth:21,mapHeight:12})})},ve=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,32)).then((function(t){var a=t.getCLS,i=t.getFID,n=t.getFCP,r=t.getLCP,l=t.getTTFB;a(e),i(e),n(e),r(e),l(e)}))};o.a.render(Object(f.jsx)(r.a.StrictMode,{children:Object(f.jsx)(je,{})}),document.getElementById("root")),ve()}],[[31,1,2]]]);
//# sourceMappingURL=main.8eca8416.chunk.js.map